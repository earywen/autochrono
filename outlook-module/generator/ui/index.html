<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook Tool Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            background: linear-gradient(135deg, #152845 0%, #1c365b 50%, #2a4a75 100%);
            color: white;
            overflow-y: auto;
        }

        .glass {
            background: rgba(23, 37, 84, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: border-color 0.2s;
        }

        .glass-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(150, 198, 62, 0.6);
            box-shadow: 0 0 10px rgba(150, 198, 62, 0.2);
            outline: none;
        }

        .btn-ginger {
            background: linear-gradient(135deg, #96c63e 0%, #7ab32e 100%);
            color: #1c365b;
            transition: all 0.2s;
        }

        .btn-ginger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(150, 198, 62, 0.3);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(150, 198, 62, 0.4);
            color: #96c63e;
            transition: all 0.2s;
        }

        .btn-ghost:hover {
            background: rgba(150, 198, 62, 0.1);
        }

        .section-label {
            background: linear-gradient(90deg, rgba(150, 198, 62, 0.15) 0%, transparent 100%);
            border-left: 2px solid #96c63e;
        }

        .kbd {
            background: #374151;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            border: 1px solid #4b5563;
        }
    </style>
</head>

<body class="p-4 flex flex-col items-center">

    <!-- Header -->
    <div class="text-center w-full mb-6 relative">
        <h1 class="text-2xl font-bold">
            <span class="text-white">Outlook</span><span class="text-[#96c63e]">ToolGen</span>
        </h1>
        <p class="text-gray-300 text-xs mt-1">G√©n√©rateur d'outils unifi√© pour Outlook (Chronos & AR)</p>
    </div>

    <div class="flex flex-row gap-4 w-full h-[calc(100vh-100px)] max-w-5xl">

        <!-- LEFT: Form -->
        <div class="glass rounded-xl p-5 w-[350px] flex flex-col shrink-0">

            <div class="section-label px-2 py-1 rounded-r mb-4">
                <span class="text-xs font-semibold text-[#96c63e]">üî® Configuration G√©n√©rale</span>
            </div>

            <div class="space-y-4 mb-6">

                <!-- Bloc Chrono -->
                <div class="space-y-3">
                    <p class="text-[11px] text-[#96c63e] font-semibold border-b border-white/10 pb-1">Param√®tres Chrono
                    </p>

                    <div>
                        <label class="block text-[10px] text-gray-300 mb-1">Votre Trigramme (*)</label>
                        <input type="text" id="trigram" placeholder="Ex: ARME"
                            class="glass-input w-full px-2 py-2 rounded-lg text-xs text-white placeholder-gray-500 uppercase">
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-300 mb-1">Fichier Excel Chrono (*)</label>
                        <div class="flex gap-1">
                            <input type="text" id="chronoFile" placeholder="\\serveur\Chrono.xlsx"
                                class="glass-input flex-1 px-2 py-2 rounded-lg text-xs text-white placeholder-gray-500">
                            <button onclick="browseFile()" class="btn-ghost px-2 py-2 rounded-lg text-xs">üìÑ</button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-300 mb-1">Dossier Racine Chrono (*)</label>
                        <div class="flex gap-1">
                            <input type="text" id="chronoFolder" placeholder="\\serveur\Chrono"
                                class="glass-input flex-1 px-2 py-2 rounded-lg text-xs text-white placeholder-gray-500">
                            <button onclick="browseFolder()" class="btn-ghost px-2 py-2 rounded-lg text-xs">üìÇ</button>
                        </div>
                    </div>
                </div>

                <!-- End of inputs -->

            </div>

            <!-- Generate Button -->
            <div class="mt-auto pt-2 border-t border-white/10">
                <button onclick="generateSession()" id="btn-generate"
                    class="btn-ginger w-full py-3 rounded-xl text-sm font-bold shadow-lg flex items-center justify-center gap-2">
                    <span>üìã</span> G√©n√©rer & Copier le Code
                </button>
            </div>
        </div>

        <!-- RIGHT: Unified Tutorial -->
        <div class="glass rounded-xl p-5 flex-1 flex flex-col relative">
            <div class="absolute top-4 right-4 bg-[#96c63e]/20 text-[#96c63e] text-[10px] font-bold px-2 py-1 rounded">
                Version Unifi√©e
            </div>

            <h2 class="text-sm font-bold mb-4 border-b border-white/10 pb-2">üìñ Installation dans Outlook</h2>

            <div class="flex-1 space-y-5 overflow-y-auto pr-2"
                style="scrollbar-width: thin; scrollbar-color: #96c63e transparent;">

                <!-- Step 1 -->
                <div>
                    <div class="bg-[#96c63e]/20 rounded-md px-2 py-1 mb-2 inline-block">
                        <span class="text-xs font-bold text-[#96c63e]">√âTAPE 1 : Copier le code</span>
                    </div>
                    <div class="text-xs text-gray-300 pl-3 space-y-1">
                        <p>1. Remplissez tous les champs obligatoires (*) √† gauche.</p>
                        <p>2. Cliquez sur le gros bouton <b class="text-[#96c63e]">üìã G√©n√©rer & Copier le Code</b>.</p>
                        <p class="text-[10px] text-gray-400 italic">Le code VBA complet pour les deux outils (Chrono +
                            AR) est maintenant dans votre presse-papier.</p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div>
                    <div class="bg-blue-500/20 rounded-md px-2 py-1 mb-2 inline-block">
                        <span class="text-xs font-bold text-blue-400">√âTAPE 2 : Coller dans Outlook</span>
                    </div>
                    <div class="text-xs text-gray-300 pl-3 space-y-1">
                        <p>1. Ouvrez Outlook et appuyez sur <span class="kbd">Alt</span> + <span class="kbd">F11</span>
                            pour ouvrir l'√©diteur VBA.</p>
                        <p>2. Dans le menu de gauche, double-cliquez sur <b>ThisOutlookSession</b> sous "Microsoft
                            Outlook Objects".</p>
                        <p>3. Cliquez n'importe o√π dans la grande fen√™tre blanche de droite.</p>
                        <p>4. <b>S√©lectionnez tout</b> (<span class="kbd">Ctrl</span>+<span class="kbd">A</span>) et
                            <b>supprimez</b> le contenu existant √©ventuel.
                        </p>
                        <p>5. <b>Collez</b> (<span class="kbd">Ctrl</span>+<span class="kbd">V</span>) le nouveau code.
                        </p>
                        <p>6. <b class="text-white">Sauvegardez</b> (<span class="kbd">Ctrl</span>+<span
                                class="kbd">S</span>) et fermez l'√©diteur VBA.</p>
                        <p class="text-[10px] text-[#96c63e] mt-1 font-semibold">L'archivage automatique √† l'envoi est
                            d√©sormais activ√© !</p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div>
                    <div class="bg-red-500/20 rounded-md px-2 py-1 mb-2 inline-block">
                        <span class="text-xs font-bold text-red-400">√âTAPE 3 : Ajouter les boutons (Essentiel !)</span>
                    </div>
                    <div class="text-xs text-gray-300 pl-3 space-y-2">
                        <p>Pour pouvoir cr√©er de nouveaux Chronos ou envoyer des Accus√©s, vous <b>devez</b> ajouter les
                            macros sous forme de boutons cliquables dans Outlook :</p>

                        <div class="bg-black/20 p-2 rounded border border-white/5 mt-1">
                            <p class="font-semibold text-[#96c63e] mb-1">‚ñ∂ Bouton Nouveau Chrono (Fen√™tre Principale)
                            </p>
                            <ul class="list-none space-y-1 text-[11px]">
                                <li>1. Depuis l'accueil Outlook, allez dans <b>Fichier > Options > Personnaliser le
                                        ruban</b>.</li>
                                <li>2. √Ä droite (onglets principaux), cliquez sur <b>Nouveau groupe</b> et renommez-le
                                    "Outils".</li>
                                <li>3. √Ä gauche sous "Choisir les commandes", s√©lectionnez <b>Macros</b>.</li>
                                <li>4. S√©lectionnez <b>NouveauChrono</b> et cliquez sur <b>Ajouter >></b>.</li>
                                <li>5. Cliquez sur <b>Renommer</b> pour lui donner une ic√¥ne üìÅ et un nom propre.</li>
                            </ul>
                        </div>

                        <div class="bg-black/20 p-2 rounded border border-white/5">
                            <p class="font-semibold text-[#96c63e] mb-1">‚ñ∂ Bouton Accus√© R√©ception (Fen√™tre de Message)
                            </p>
                            <ul class="list-none space-y-1 text-[11px]">
                                <li>1. Ouvrez un message (ou cr√©ez-en un nouveau) pour afficher le ruban "Message".</li>
                                <li>2. Refaites la m√™me op√©ration (Options > Personnaliser le ruban).</li>
                                <li>3. Cr√©ez un groupe, choisissez Macros > <b>AccuseReception</b> et cliquez sur
                                    <b>Ajouter >></b>.</li>
                                <li>4. Renommez avec une ic√¥ne üì®.</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- Script JS Unifi√© -->
    <script>
        window.addEventListener('pywebviewready', () => console.log('Ready'));

        async function browseFolder() {
            try {
                const r = await pywebview.api.browse_folder();
                if (r) document.getElementById('chronoFolder').value = r;
            } catch (e) { console.error(e); }
        }

        async function browseFile() {
            try {
                const r = await pywebview.api.browse_file();
                if (r) document.getElementById('chronoFile').value = r;
            } catch (e) { console.error(e); }
        }

        async function generateSession() {
            const btn = document.getElementById('btn-generate');
            const originalText = btn.innerHTML;

            // Validation
            const trigram = document.getElementById('trigram').value.trim().toUpperCase();
            const chronoFile = document.getElementById('chronoFile').value.trim();
            const chronoFolder = document.getElementById('chronoFolder').value.trim();

            if (!trigram || !chronoFile || !chronoFolder) {
                alert("Veuillez remplir tous les champs obligatoires (*) pour le module Chrono.");
                return;
            }

            const data = {
                trigram: trigram,
                chronoFile: chronoFile,
                chronoFolder: chronoFolder
            };

            btn.innerHTML = '<span class="animate-spin">‚è≥</span> G√©n√©ration...';
            btn.disabled = true;

            try {
                const r = await pywebview.api.generate_unified_session(data);

                if (r.success) {
                    btn.innerHTML = '<span>‚úÖ</span> Copi√© !';
                    btn.classList.replace('btn-ginger', 'bg-green-600');
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.replace('bg-green-600', 'btn-ginger');
                        btn.disabled = false;
                    }, 3000);
                } else {
                    alert('‚ùå Erreur de g√©n√©ration : ' + r.error);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            } catch (e) {
                console.error('Session error:', e);
                alert('‚ùå Erreur critique : ' + e.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>

</html>