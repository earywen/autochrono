# Architecture

> Generated by /map on 2026-02-20
> **Target Scope:** `outlook-module/generator/` (OutlookToolGen)

## Overview
OutlookToolGen is an advanced Python-based generator utility designed to create custom VBA modules for Microsoft Outlook. Unlike the basic AutoChrono version, this generator supports two distinct productivity tools:
1. **ChronoCreator:** Automates the creation of network folders and Excel log entries for outbound proposals/reports, and copies a standardized "REF" tag to the clipboard.
2. **AccuseReception (AR):** Generates a standardized, pre-filled HTML reply for project proposals and automatically prompts the user to archive the email to a network folder upon sending.

The application allows users to generate these tools as standalone VBA modules (`.bas`) or as a unified `ThisOutlookSession` script that merges their event-handling logic (`Application_ItemSend`) to prevent conflicts in Outlook.

## System Diagram
```text
[ User / End-user ]
       │ 1. Inputs config (Trigram, Paths) in PyWebView GUI
       ▼
[ Python GUI (ui/index.html + main.py) ]
       │ 2. Passes config and ToolType ('CHRONO', 'AR', or 'MERGED')
       ▼
[ VBA Generator (vba_generator.py) ]
       │ 3. Injects Configuration into specific VBA templates
       ├──────────────────────────────┬─────────────────────────────┐
       ▼                              ▼                             ▼
[ ChronoCreator.bas ]         [ AccuseReception.bas ]       [ Merged Session Code ]
(Standalone Macro)            (Standalone Macro)            (Clipboard - For ThisOutlookSession)
       │                              │                             │
       └──────────────┬───────────────┘                             │
                      │ 4. User imports into Outlook                │
                      ▼                                             ▼
             [ Outlook Ribbon Buttons ]                 [ Outlook Event Handler ]
             (Triggered manually by user)               (Triggered on ItemSend)
```

## Components

### Configuration Frontend
- **Purpose:** Collects user specific settings and paths; provides a tutorial/guide UI for installation.
- **Location:** `main.py` (entry point handling PyWebView), `ui/index.html` (Web UI built with TailwindCSS, handling view transitions between 'Home', 'Chrono', and 'AR').
- **Dependencies:** `pywebview`, `vba_generator.py`, TailwindCSS (external via CDN).
- **Dependents:** Used directly by the end-user.

### VBA Generator
- **Purpose:** Injects user configuration into predefined VBA boilerplates. Contains distinct templates for Chrono, AR, and a Session-Merged version.
- **Location:** `vba_generator.py`
- **Dependencies:** None (pure string manipulation).
- **Dependents:** `main.py`.

### Generated VBA Payloads

#### 1. ChronoCreator (`_get_chrono_template`)
- **Execution:** Triggered manually via an Outlook ribbon button.
- **Action:** Prompts user via `InputBox` for client details, finds the next available Chrono number in Excel, adds a row, creates a network folder, and copies the `REF` to the clipboard.
- **Integration:** Excel COM (Read/Write), Windows FileSystemObject, Windows Clipboard API.

#### 2. Accuse Reception (`_get_ar_template`)
- **Execution:** Triggered manually via an Outlook ribbon button inside an open email.
- **Action:** Prompts for Project Manager/Supervisor names and dates. Generates an HTML reply table. Tags the email with a custom UserProperty (`ActionAR = "True"`) for later interception.
- **Integration:** Outlook MailItem DOM (`.HTMLBody`, `.Reply`, `.UserProperties`).

#### 3. Merged Session Code (`_get_session_merged_template`)
- **Execution:** Triggered automatically on `Application_ItemSend`.
- **Action:** 
  - *Chrono Logic:* Scans body for "REF... N°...", finds the matching folder, and archives the `.msg`.
  - *AR Logic:* Checks if `ActionAR = "True"`, prompts user for a destination folder (`Shell.Application.BrowseForFolder`), and archives the `.msg`.
- **Integration:** Outlook Events, FileSystemObject, Windows Shell Application.

## Data Flow
1. User launches the generator executable. The Python script spawns a local PyWebView window loading `index.html`.
2. User selects the desired tool (Chrono or AR) and fills out the configuration.
3. User clicks "Generate Module" (saves a `.bas` file) or "Copy Session" (copies to clipboard).
4. JavaScript calls the native Python API `api.generate_module(data)` or `api.generate_session(data)`.
5. `main.py` instantiates `ChronoCreatorGenerator` and processes the appropriate template.
6. The user manually installs the `.bas` files (assigning them to ribbon buttons) and pastes the Session code into `ThisOutlookSession`.

## Integration Points
| External Service | Type | Purpose |
|------------------|------|---------|
| Microsoft Outlook | COM Event / Object Model | UI Buttons, Email Reply generation, Custom Properties (`ActionAR`), Event interception (`ItemSend`). |
| Microsoft Excel | COM Interop | Lookup and writing of Chrono client data. |
| Windows File System | I/O | Folder creation and `.msg` file saving. |
| Windows Shell/API | COM / user32.dll | Folder browsing dialog (Shell.Application) and Clipboard manipulation. |

## Conventions
- **Naming:** CamelCase for classes, snake_case for Python methods. Variables in VBA use CamelCase (`chronoNum`).
- **Templating:** Hardcoded text blocks in Python utilizing `{{PLACEHOLDERS}}` for simple `.replace()` substitution.
- **UI:** Single-page application logic in HTML/JS with DOM element toggling (`hidden` class) to switch views.

## Technical Debt
- [ ] VBA Templates are hardcoded as massive multi-line strings inside `vba_generator.py` instead of separate `.bas` or `.txt` template files.
- [ ] No separation of concerns in `index.html` (CSS, JS, and HTML are all in one file).
- [ ] No automated testing framework (e.g., `pytest`) is present in the repository.
- [ ] Duplicated logic in the `.spec` files (`ChronoCreatorGenerator.spec` and `Generator.spec`).
