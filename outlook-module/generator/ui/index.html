<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook Tool Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            overflow: hidden;
            height: 100%;
        }

        body {
            background: linear-gradient(135deg, #152845 0%, #1c365b 50%, #2a4a75 100%);
        }

        .glass {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.2s;
        }

        .glass-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(150, 198, 62, 0.6);
            box-shadow: 0 0 10px rgba(150, 198, 62, 0.2);
            outline: none;
        }

        .btn-ginger {
            background: linear-gradient(135deg, #96c63e 0%, #7ab32e 100%);
            color: #1c365b;
            transition: all 0.2s;
        }

        .btn-ginger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(150, 198, 62, 0.3);
        }

        .btn-ghost {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(150, 198, 62, 0.4);
            color: #96c63e;
            transition: all 0.2s;
        }

        .btn-ghost:hover {
            background: rgba(150, 198, 62, 0.1);
        }

        .card-hover:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.1);
            border-color: #96c63e;
            cursor: pointer;
        }

        .section-label {
            background: linear-gradient(90deg, rgba(150, 198, 62, 0.15) 0%, transparent 100%);
            border-left: 2px solid #96c63e;
        }

        .tutorial-scroll {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #96c63e transparent;
        }

        .tutorial-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .tutorial-scroll::-webkit-scrollbar-thumb {
            background: #96c63e;
            border-radius: 2px;
        }

        .kbd {
            background: #374151;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="text-white p-3 flex flex-col h-full">

    <!-- Header Common -->
    <div class="text-center mb-4 relative">
        <h1 class="text-xl font-bold">
            <span class="text-white">Outlook</span><span class="text-[#96c63e]">ToolGen</span>
        </h1>
        <p class="text-gray-400 text-[10px]">Generateur d'outils bureautiques</p>

        <!-- Back Button (Hidden on Home) -->
        <button id="btn-home" onclick="goHome()"
            class="hidden absolute left-0 top-1 text-[10px] btn-ghost px-2 py-1 rounded flex items-center gap-1">
            <span>‚¨Ö</span> Accueil
        </button>
    </div>

    <!-- VIEW: HOME -->
    <div id="view-home" class="flex-1 flex flex-col items-center justify-center gap-6 animate-fade-in">
        <div class="text-center">
            <h2 class="text-lg font-semibold mb-1">Quel outil souhaitez-vous installer ?</h2>
            <p class="text-gray-400 text-xs">Selectionnez un module pour generer son installateur VBA.</p>
        </div>

        <div class="flex gap-4 w-full max-w-2xl px-8 h-[220px]">
            <!-- Card Chrono -->
            <div onclick="switchView('CHRONO')"
                class="glass card-hover rounded-xl p-6 flex-1 flex flex-col items-center justify-center gap-4 transition-all duration-300">
                <div class="w-16 h-16 rounded-full bg-[#96c63e]/20 flex items-center justify-center text-3xl">
                    üìÇ
                </div>
                <div class="text-center">
                    <h3 class="font-bold text-[#96c63e] mb-1">Generateur Chrono</h3>
                    <p class="text-[10px] text-gray-300">Creez vos dossiers et numeros chrono en 1 clic. Lie a Excel.
                    </p>
                </div>
            </div>

            <!-- Card AR -->
            <div onclick="switchView('AR')"
                class="glass card-hover rounded-xl p-6 flex-1 flex flex-col items-center justify-center gap-4 transition-all duration-300">
                <div class="w-16 h-16 rounded-full bg-[#96c63e]/20 flex items-center justify-center text-3xl">
                    üì®
                </div>
                <div class="text-center">
                    <h3 class="font-bold text-[#96c63e] mb-1">Accuse Reception</h3>
                    <p class="text-[10px] text-gray-300">Reponse standardisee + classement automatique du mail envoye.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: CHRONO -->
    <div id="view-chrono" class="hidden flex gap-3 flex-1 overflow-hidden animate-fade-in">
        <!-- LEFT: Form -->
        <div class="glass rounded-xl p-4 w-[320px] flex flex-col">
            <div class="section-label px-2 py-0.5 rounded-r mb-2">
                <span class="text-[10px] font-semibold text-[#96c63e]">üîß Configuration Chrono</span>
            </div>

            <div class="space-y-3 mb-4">
                <div>
                    <label class="block text-[10px] text-gray-400 mb-0.5">Votre Trigramme</label>
                    <input type="text" id="trigram" placeholder="Ex: ARME"
                        class="glass-input w-full px-2 py-1.5 rounded-lg text-xs text-white placeholder-gray-500 uppercase">
                </div>

                <div class="h-px bg-white/10 my-2"></div>

                <div>
                    <label class="block text-[10px] text-gray-400 mb-0.5">Fichier Excel Chrono</label>
                    <div class="flex gap-1">
                        <input type="text" id="chronoFile" placeholder="\\serveur\Chrono.xlsx"
                            class="glass-input flex-1 px-2 py-1.5 rounded-lg text-xs text-white placeholder-gray-500">
                        <button onclick="browseFile()" class="btn-ghost px-2 py-1.5 rounded-lg text-[10px]">üìÑ</button>
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] text-gray-400 mb-0.5">Dossier Racine Chrono</label>
                    <div class="flex gap-1">
                        <input type="text" id="chronoFolder" placeholder="\\serveur\Chrono"
                            class="glass-input flex-1 px-2 py-1.5 rounded-lg text-xs text-white placeholder-gray-500">
                        <button onclick="browseFolder()"
                            class="btn-ghost px-2 py-1.5 rounded-lg text-[10px]">üìÇ</button>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="mt-auto space-y-2">
                <button onclick="generateModule('CHRONO')"
                    class="btn-ginger w-full py-2.5 rounded-xl text-xs font-bold">
                    üì¶ 1. Generer ChronoCreator.bas
                </button>
                <button onclick="generateSession('CHRONO')"
                    class="btn-ghost w-full py-2.5 rounded-xl text-xs font-semibold">
                    üìã 2. Copier Session (Auto-Filing)
                </button>
            </div>
        </div>

        <!-- RIGHT: Tutorial Chrono -->
        <div class="glass rounded-xl p-4 flex-1 flex flex-col overflow-hidden">
            <h2 class="text-sm font-bold mb-3 text-center">üìñ Installation Chrono</h2>
            <div class="tutorial-scroll flex-1 pr-2 space-y-4">

                <!-- Step 1 -->
                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 1 : Generer les fichiers</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>1. Remplissez vote <b>Trigramme</b> et les chemins.</p>
                        <p>2. Cliquez sur <b class="text-[#96c63e]">1. Generer ChronoCreator.bas</b> et sauvegardez-le.
                        </p>
                        <p>3. Cliquez sur <b class="text-white">2. Copier Session</b> (ne collez rien pour l'instant).
                        </p>
                    </div>
                </div>

                <!-- Step 2 -->
                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 2 : Importer le module</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>1. Dans Outlook, faites <span class="kbd">Alt</span> + <span class="kbd">F11</span>.</p>
                        <p>2. Allez dans <b>Fichier > Importer un fichier...</b></p>
                        <p>3. Selectionnez le fichier <b>ChronoCreator.bas</b>.</p>
                    </div>
                </div>

                <!-- Step 3 -->
                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 3 : Activer l'auto-classement</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>1. A gauche, double-cliquez sur <b>ThisOutlookSession</b>.</p>
                        <p>2. Collez le code (Ctrl+V) dans la fenetre blanche.</p>
                        <p>3. Sauvegardez (<span class="kbd">Ctrl</span>+<span class="kbd">S</span>) et fermez la
                            fenetre.</p>
                    </div>
                </div>

                <!-- Step 4 -->
                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 4 : Ajouter le bouton</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>1. Allez dans <b>Fichier > Options > Personnaliser le ruban</b></p>
                        <p class="text-[#96c63e] italic text-[10px]">Astuce : Pour le mettre dans la fenetre "Message",
                            faites ceci depuis un Nouveau Message !</p>
                        <p>2. A droite, choisissez l'onglet (ex: <b>Accueil</b> ou <b>Message</b>)</p>
                        <p>3. Cliquez <b>Nouveau groupe</b> &rarr; Renommez "Chrono"</p>
                        <p>4. Liste "Choisir les commandes" (gauche) : choisissez <b>Macros</b></p>
                        <p>5. Selectionnez <b class="text-[#96c63e]">NouveauChrono</b></p>
                        <p>6. Cliquez <b>Ajouter >></b></p>
                        <p>7. Cliquez <b>Renommer</b> pour changer l'icone/nom</p>
                        <p>8. Validez par <b>OK</b></p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- VIEW: AR -->
    <div id="view-ar" class="hidden flex gap-3 flex-1 overflow-hidden animate-fade-in">
        <!-- LEFT: Form -->
        <div class="glass rounded-xl p-4 w-[320px] flex flex-col">
            <div class="section-label px-2 py-0.5 rounded-r mb-2">
                <span class="text-[10px] font-semibold text-[#96c63e]">üîß Configuration</span>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center text-center p-4 mb-4">
                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-3">
                    <span class="text-2xl">‚ú®</span>
                </div>
                <p class="text-gray-300 text-xs font-medium mb-1">Aucune configuration requise</p>
                <p class="text-[10px] text-gray-500 italic">
                    Le module utilisera votre signature Outlook existante pour les coordonnees.
                </p>
            </div>

            <!-- Buttons -->
            <div class="mt-auto space-y-2">
                <button onclick="generateModule('AR')" class="btn-ginger w-full py-2.5 rounded-xl text-xs font-bold">
                    üì¶ 1. Generer AccuseReception.bas
                </button>
                <!-- AR doesn't need session code necessarily, but we can keep it consistent or hide it -->
                <div class="text-[10px] text-gray-500 text-center px-4">
                    Pas besoin de code Session pour ce module.<br>Le rangement est integre a la macro.
                </div>
            </div>
        </div>

        <!-- RIGHT: Tutorial AR -->
        <div class="glass rounded-xl p-4 flex-1 flex flex-col overflow-hidden">
            <h2 class="text-sm font-bold mb-3 text-center">üìñ Installation Accuse Reception</h2>
            <div class="tutorial-scroll flex-1 pr-2 space-y-4">

                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 1 : Importation</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>1. Generez et sauvegardez le fichier <b>AccuseReception.bas</b>.</p>
                        <p>2. Dans Outlook, faites <span class="kbd">Alt</span> + <span class="kbd">F11</span>.</p>
                        <p>3. <b>Fichier > Importer</b> et choisissez le fichier.</p>
                    </div>
                </div>

                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">ETAPE 2 : Ajouter le bouton</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>‚ö†Ô∏è <b>Important :</b> Ce bouton doit etre dans la fenetre de lecture/redaction.</p>
                        <p>1. Ouvrez un mail recu (double-clic) ou faites "Repondre".</p>
                        <p>2. <b>Fichier > Options > Personnaliser le ruban</b></p>
                        <p>3. A droite, choisissez l'onglet <b>Message</b> (ou Accueil)</p>
                        <p>4. Cliquez <b>Nouveau groupe</b> &rarr; Renommez "Outils"</p>
                        <p>5. Liste "Choisir les commandes" : <b>Macros</b></p>
                        <p>6. Selectionnez <b class="text-[#96c63e]">AccuseReception</b> &rarr; <b>Ajouter >></b></p>
                        <p>7. Renommez (Icone/Nom) &rarr; Validez par <b>OK</b></p>
                    </div>
                </div>

                <div>
                    <div class="bg-[#96c63e]/20 rounded-lg px-2 py-1 mb-1">
                        <span class="text-[11px] font-bold text-[#96c63e]">Astuce</span>
                    </div>
                    <div class="text-[11px] text-gray-300 pl-2 space-y-1">
                        <p>Lors de l'utilisation, une fenetre vous demandera s'il faut ranger le mail automatiquement.
                            Si vous dites OUI, choisissez le dossier du projet.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        window.addEventListener('pywebviewready', () => console.log('Ready'));

        let currentMode = 'HOME';

        function switchView(mode) {
            currentMode = mode;
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-chrono').classList.add('hidden');
            document.getElementById('view-ar').classList.add('hidden');
            document.getElementById('btn-home').classList.remove('hidden');

            if (mode === 'HOME') {
                document.getElementById('view-home').classList.remove('hidden');
                document.getElementById('btn-home').classList.add('hidden');
            } else if (mode === 'CHRONO') {
                document.getElementById('view-chrono').classList.remove('hidden');
            } else if (mode === 'AR') {
                document.getElementById('view-ar').classList.remove('hidden');
            }
        }

        function goHome() { switchView('HOME'); }

        async function browseFolder() {
            try {
                const r = await pywebview.api.browse_folder();
                if (r) document.getElementById('chronoFolder').value = r;
            } catch (e) { }
        }

        async function browseFile() {
            try {
                const r = await pywebview.api.browse_file();
                if (r) document.getElementById('chronoFile').value = r;
            } catch (e) { }
        }

        function getData(type) {
            const data = {
                toolType: type,
                trigram: document.getElementById('trigram').value.trim().toUpperCase(),
                chronoFile: document.getElementById('chronoFile').value.trim(),
                chronoFolder: document.getElementById('chronoFolder').value.trim(),
                // Inputs manquants en mode AR (car inutiles)
                userName: document.getElementById('userName') ? document.getElementById('userName').value.trim() : '',
                userPhone: document.getElementById('userPhone') ? document.getElementById('userPhone').value.trim() : ''
            };

            // Validation specific
            if (type === 'CHRONO') {
                if (!data.trigram) { alert('Trigramme requis'); return null; }
                if (!data.chronoFile) { alert('Fichier Excel requis'); return null; }
                if (!data.chronoFolder) { alert('Dossier Chrono requis'); return null; }
            }
            // For AR, no validation needed

            return data;
        }

        async function generateModule(type) {
            const data = getData(type);
            if (!data) return;
            try {
                const r = await pywebview.api.generate_module(data);
                if (r.success) {
                    alert('‚úÖ Module sauvegarde !');
                } else if (r.error !== 'Annule') {
                    alert('‚ùå ' + r.error);
                }
            } catch (e) {
                alert('‚ùå ' + e.message);
            }
        }

        async function generateSession(type) {
            const data = getData(type);
            if (!data) return;
            try {
                const r = await pywebview.api.generate_session(data);
                if (r.success) {
                    alert('‚úÖ Code copie dans le presse-papier !');
                } else {
                    alert('‚ùå ' + r.error);
                }
            } catch (e) {
                alert('‚ùå ' + e.message);
            }
        }
    </script>
</body>

</html>